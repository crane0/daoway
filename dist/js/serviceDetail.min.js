$(function () {
  //导航栏动画
  var $header = $('.header-container');
  $(window).scroll(function () {
    if($(this).scrollTop()>70){
      $header.addClass('on');
    }else {
      $header.removeClass('on');
    }
  })

  //导航栏，点击变色
  let $lis = $('.select li')
  for(let i = 0; i < $lis.length; i++){
    //这种绑定事件的方式是jQuery的，所以要包装被jQuery对象
    $($lis[i]).on('click', function () {
      for(let i = 0; i < $lis.length; i++){
        $lis[i].className = ''
      }
      this.className = 'active'
    })
  }


  /*分页*/
  let $pageShow = $('.page-show')
  $.getJSON('http://localhost:3000/getIndex', function (data) {
    console.log(data.length)
    for(var i = 0; i < data.length; i++){
      $pageShow.append('<a href="javascript:;">'+(i+1)+'</a>')
    }
    /*所有的逻辑都建立在获取所有a标签后！*/

    //默认显示第一页
    let num = 1
    //获取所有页码对应的html元素
    let $a = $('.page-show a')
    /*
    * 因为除了点击对应的页码，点击“上一页，下一页”时，也要触发逻辑，并且要页码有active样式，
    *   所以，将所有的，都和num关联起来。
    * */
    //初始化显示第一页
    page(num)
    function page(num) {
      $.getJSON('http://localhost:3000/getIndex', function (data) {
        //获取到数据，渲染之前，先确定样式
        // for(let i = 0; i < $a.length; i++){
        //   //2中方式，一个是DOM的方法，一个是jQuery的方法
        //   // $a[i].className = ''
        //   $a.eq(i).removeClass('active')
        // }
        //这样就是匹配所有满足条件的
        $a.removeClass('active')
        // $a[num-1].className = 'active'
        $a.eq(num-1).addClass('active')
        /*
        * 截取一页要显示的数据。
        *   渲染的数据是data数组中，每个对象的shopList，
        *   所以，每次只需要一个data数组的元素
        * */
        data = data.slice(num-1,num)
        $('.category-list-detail').html(template('box1', {data: data}))
      })
    }


    //上一页
    let $pageUp = $('.page-up')
    $pageUp.on('click', function () {
      num--;
      if (num == 1) {
        $pageUp.removeClass('active')
      } else if (num < 1) {
        num = 1;
        alert("已经是第一页！")
        return
      } else if (num < 10) {
        $pageDown.addClass('active')
      }
      page(num)
    })

    //下一页
    let $pageDown = $('.page-down')
    $pageDown.on('click', function () {
      num++;
      if (num > 1) {
        $pageUp.addClass('active')
      }
      if (num == 10) {
        $pageDown.removeClass('active')
      } else if (num > 10) {
        num = 10;
        alert("已经是最后一页！")
        return
      }
      page(num)
    })

    //点击对应页码跳转
    //立flag，重复点击同一页，无效
    let num1 = 0
    $a.on('click', function () {
      num = $(this).html()
      //重复点击同一页，无效
      if (num1 == num) {
        return
      }
      num1 = num
      // console.log(num, typeof num)
      //不能用全等，因为获取的innerHtml是string
      if (num == 1) {
        $pageUp.removeClass('active')
      } else if (num > 1) {
        $pageUp.addClass('active')
      }
      if (num == 10) {
        $pageDown.removeClass('active')
      } else if (num < 10) {
        $pageDown.addClass('active')
      }
      page(num)
    })

  })

})

